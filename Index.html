<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nota ZALTA GIFT</title>

<style>
body{font-family:Arial,sans-serif;background:#f5f5f5;padding:8px}
h2,h3{text-align:center;margin:4px 0}
.form,table{background:#fff;padding:8px;border-radius:6px}
label{font-size:13px;font-weight:bold}
input{width:100%;height:38px;font-size:15px;padding:5px;border:1px solid #888;border-radius:4px}
input[type=number]{text-align:center}
input[type=text]{text-align:right}
.row{display:flex;gap:6px}
table{width:100%;border-collapse:collapse;margin-top:8px}
th,td{border:1px solid #ccc;padding:4px;font-size:13px;text-align:center}
th{background:#eee}
.total{text-align:right;font-weight:bold}
.actions button{font-size:12px;padding:4px 6px}
.minus{color:red}
.plus{color:green}
@media print{.form,.actions,input,button{display:none!important}}
@page{size:80mm auto;margin:3mm}
</style>
</head>

<body>

<h2>üìí ZALTA GIFT</h2>
<div style="text-align:center;font-size:11px">
<b>ZALTA GIFT</b><br>
Barahan RT 05 RW 02 Tarub<br>
Tawangharjo, Grobogan<br>
WA: 08816575574 / 081476698677<br>
<span id="datetime"></span>
</div>

<div class="form">
<label>Nama Barang</label>
<input id="iBarang" placeholder="Nama barang" autofocus>

<div class="row" style="margin-top:6px">
<div>
<label>Qty</label>
<!-- QTY DESIMAL AKTIF -->
<input type="number" id="iQty" step="0.01" inputmode="decimal" placeholder="0">
</div>
<div>
<label>Harga</label>
<input type="text" id="iHarga" placeholder="0">
</div>
</div>
<small>‚èé ENTER untuk tambah barang</small>
</div>

<table id="tabel">
<tr>
<th>No</th><th>Barang</th><th>Qty</th><th>Harga</th><th>Total</th><th>Aksi</th>
</tr>
</table>

<h3>Total : Rp <span id="grand">0</span></h3>

<label>Jumlah TF</label>
<input id="tf" type="text">

<h3><span id="labelSisa">Sisa</span> : Rp <span id="sisa">0</span></h3>

<div class="actions">
<button onclick="shareWA()">üì§ Share WA</button>
<button onclick="window.print()">üñ® Print</button>
</div>

<script>
const barang=document.getElementById('iBarang');
const qty=document.getElementById('iQty');
const harga=document.getElementById('iHarga');
const tfEl=document.getElementById('tf');
const tabel=document.getElementById('tabel');
const grandEl=document.getElementById('grand');
const sisaEl=document.getElementById('sisa');
const labelSisa=document.getElementById('labelSisa');

function angka(v){return Number(String(v).replace(/\D/g,''))||0}
function rupiah(n){return Number(n).toLocaleString('id-ID')}

harga.addEventListener('input',()=>harga.value=rupiah(angka(harga.value)));
tfEl.addEventListener('input',()=>{tfEl.value=rupiah(angka(tfEl.value));hitungSisa()});

document.addEventListener('keydown',e=>{
if(e.key==='Enter'){e.preventDefault();tambah()}
});

function tambah(){
const b=barang.value.trim();
const q=parseFloat(qty.value);   // ‚úÖ DESIMAL
const h=angka(harga.value);
if(!b||!q||q<=0||h<=0) return;

const tr=document.createElement('tr');
tr.dataset.qty=q;
tr.dataset.harga=h;

tr.innerHTML=`
<td></td>
<td><input value="${b}"></td>
<td><input type="number" step="0.01" value="${q}"></td>
<td><input value="${rupiah(h)}"></td>
<td class="total"></td>
<td><button onclick="hapus(this)">‚ùå</button></td>
`;

tr.querySelectorAll('input').forEach(inp=>{
inp.oninput=()=>updateRow(tr);
});

tabel.appendChild(tr);
barang.value=qty.value=harga.value='';
barang.focus();
update();
}

function updateRow(tr){
const q=parseFloat(tr.children[2].firstChild.value)||0; // ‚úÖ DESIMAL
const h=angka(tr.children[3].firstChild.value);
tr.dataset.qty=q;
tr.dataset.harga=h;
tr.children[3].firstChild.value=rupiah(h);
update();
}

function hapus(btn){
btn.closest('tr').remove();
update();
}

function update(){
let grand=0;
[...tabel.rows].forEach((tr,i)=>{
if(i===0) return;
tr.cells[0].innerText=i;
const t=tr.dataset.qty*tr.dataset.harga;
tr.cells[4].innerText=rupiah(t);
grand+=t;
});
grandEl.innerText=rupiah(grand);
hitungSisa();
}

function hitungSisa(){
const s=angka(tfEl.value)-angka(grandEl.innerText);
sisaEl.innerText=rupiah(Math.abs(s));
labelSisa.innerText=s<0?'Kurang':s>0?'Kembali':'Pas';
labelSisa.className=s<0?'minus':s>0?'plus':'';
}

function shareWA(){
let list='';
[...tabel.rows].forEach((tr,i)=>{
if(i===0) return;
list+=`${i}. ${tr.cells[1].firstChild.value} (${tr.dataset.qty} x ${rupiah(tr.dataset.harga)}) = Rp ${tr.cells[4].innerText}\n`;
});

const text=`*ZALTA GIFT*
Barahan RT 05 RW 02 Tarub
Tawangharjo, Grobogan
WA: 08816575574 / 081476698677

Tanggal: ${new Date().toLocaleDateString('id-ID')}
Jam    : ${new Date().toLocaleTimeString('id-ID')}
-------------------------
${list}-------------------------
TOTAL : Rp ${grandEl.innerText}
TF    : Rp ${tfEl.value||0}
${labelSisa.innerText.toUpperCase()} : Rp ${sisaEl.innerText}
-------------------------
Terima kasih üôè`;

window.open('https://wa.me/?text='+encodeURIComponent(text));
}

setInterval(()=>document.getElementById('datetime').innerText=new Date().toLocaleString('id-ID'),1000);
</script>

</body>
</html>
