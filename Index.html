<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catatan Hitung - Zalta Gift</title>

<style>
body{
  font-family:Arial, sans-serif;
  background:#f5f5f5;
  padding:10px;
}
h2,h3{text-align:center;margin:6px 0}

/* FORM */
.form{
  background:#fff;
  padding:10px;
  border-radius:6px;
  margin-bottom:10px;
}
label{font-size:13px;font-weight:bold}
input{
  width:100%;
  height:40px;
  padding:6px;
  font-size:16px;
  font-weight:bold;
  box-sizing:border-box;
  border:1px solid #888;
  border-radius:4px;
}
input[type=text]{text-align:right;font-size:18px}
input[type=number]{text-align:center}
.row{display:flex;gap:6px}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  font-size:14px;
  text-align:center;
}
th{background:#eee}
.total{text-align:right;font-weight:bold}

/* BUTTON */
button{
  width:100%;
  padding:10px;
  font-size:16px;
  margin-top:6px;
}

/* WARNA KURANG / KEMBALI */
.minus{color:red;font-weight:bold}
.plus{color:green;font-weight:bold}

/* PRINT */
@media print{
  body{background:#fff;padding:0;font-size:11px}
  .form,button,input{display:none}
}
@page{
  size:80mm auto;
  margin:3mm;
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>

<h2>ðŸ“’ ZALTA GIFT</h2>

<div class="form">
  <label>Nama Barang</label>
  <input id="iBarang">

  <div class="row" style="margin-top:6px">
    <div style="flex:1">
      <label>Qty</label>
      <input type="number" id="iQty">
    </div>
    <div style="flex:1">
      <label>Harga</label>
      <input type="text" id="iHarga" oninput="formatRupiahInput(this)">
    </div>
  </div>

  <button onclick="tambah()">âž• Tambah</button>
</div>

<table id="tabel">
<tr>
  <th>No</th>
  <th>Barang</th>
  <th>Qty</th>
  <th>Harga</th>
  <th>Total</th>
</tr>
</table>

<h3>Grand Total : Rp <span id="grand">0</span></h3>

<label>Jumlah Transfer (TF)</label>
<input type="text" id="tf" oninput="formatRupiahInput(this); hitungSisa()">

<h3>
  <span id="labelSisa">Sisa</span> :
  Rp <span id="sisa">0</span>
</h3>

<button onclick="exportPDF()">ðŸ“„ Export PDF</button>

<script>
const iBarang = document.getElementById('iBarang');
const iQty = document.getElementById('iQty');
const iHarga = document.getElementById('iHarga');
const tabel = document.getElementById('tabel');
const tf = document.getElementById('tf');
const grandEl = document.getElementById('grand');
const sisaEl = document.getElementById('sisa');
const labelSisa = document.getElementById('labelSisa');

function formatRupiahInput(el){
  let v = el.value.replace(/\D/g,'');
  el.value = v ? Number(v).toLocaleString('id-ID') : '';
}
function getNumber(el){
  return Number(el.value.replace(/\./g,'')) || 0;
}
function rupiah(n){
  return Number(n).toLocaleString('id-ID');
}

function tambah(){
  const barang = iBarang.value;
  const qty = Number(iQty.value);
  const harga = getNumber(iHarga);
  if(!barang || qty<=0 || harga<=0) return;

  const total = qty * harga;
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td></td>
    <td>${barang}</td>
    <td>${qty}</td>
    <td>${rupiah(harga)}</td>
    <td class="total">${rupiah(total)}</td>
  `;
  tabel.appendChild(tr);

  iBarang.value='';
  iQty.value='';
  iHarga.value='';
  update();
}

function update(){
  let grand = 0;
  document.querySelectorAll('#tabel tr').forEach((tr,i)=>{
    if(i===0) return;
    tr.children[0].innerText = i;
    grand += Number(tr.children[4].innerText.replace(/\./g,'')) || 0;
  });
  grandEl.innerText = rupiah(grand);
  hitungSisa();
}

function hitungSisa(){
  const grand = Number(grandEl.innerText.replace(/\./g,'')) || 0;
  const tfVal = getNumber(tf);
  const hasil = tfVal - grand;

  sisaEl.className='';
  labelSisa.className='';

  if(hasil < 0){
    labelSisa.innerText = 'Kurang';
    sisaEl.classList.add('minus');
    labelSisa.classList.add('minus');
  }else if(hasil > 0){
    labelSisa.innerText = 'Kembali';
    sisaEl.classList.add('plus');
    labelSisa.classList.add('plus');
  }else{
    labelSisa.innerText = 'Pas';
  }
  sisaEl.innerText = rupiah(Math.abs(hasil));
}

function exportPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({unit:'mm',format:[80,200]});
  let y=10;
  doc.text('ZALTA GIFT',40,y,{align:'center'}); y+=6;
  doc.text(`Total : Rp ${grandEl.innerText}`,5,y); y+=6;
  doc.text(`TF    : Rp ${rupiah(getNumber(tf))}`,5,y); y+=6;
  doc.text(`${labelSisa.innerText} : Rp ${sisaEl.innerText}`,5,y);
  doc.save('nota.pdf');
}
</script>

</body>
</html>
