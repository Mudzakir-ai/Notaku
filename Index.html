<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catatan Hitung - Zalta Gift</title>

<style>
body{
  font-family:Arial, sans-serif;
  background:#f5f5f5;
  padding:10px;
}
h2,h3{text-align:center;margin:6px 0}

/* FORM */
.form{
  background:#fff;
  padding:10px;
  border-radius:6px;
  margin-bottom:10px;
}
label{font-size:13px;font-weight:bold}
input{
  width:100%;
  height:40px;
  padding:6px;
  font-size:16px;
  font-weight:bold;
  box-sizing:border-box;
  border:1px solid #888;
  border-radius:4px;
}
input[type=text]{text-align:right;font-size:18px}
input[type=number]{text-align:center}
.row{display:flex;gap:6px}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  font-size:14px;
  text-align:center;
}
th{background:#eee}
.total{text-align:right;font-weight:bold}

/* BUTTON */
button{
  width:100%;
  padding:10px;
  font-size:16px;
  margin-top:6px;
}
td button{
  width:auto;
  padding:4px 6px;
  font-size:12px;
}

/* PRINT */
@media print{
  body{background:#fff;padding:0;font-size:11px}
  .form,button,input{display:none !important}
  th,td{
    border:none;
    border-bottom:1px dashed #000;
    padding:2px;
    font-size:11px;
  }
  th:last-child,td:last-child{display:none}
}
@page{
  size:80mm auto;
  margin:3mm;
}
</style>
</head>

<body>

<h2>üìí ZALTA GIFT</h2>
<div style="text-align:center;font-size:12px;">
  Barahan RT 05 RW 02 Tarub<br>
  Tawangharjo, Grobogan<br>
  HP / WA: 08816575574 / 081476698677
</div>

<!-- FORM INPUT -->
<div class="form">
  <label>Nama Barang</label>
  <input id="iBarang" placeholder="Nama barang">

  <div class="row" style="margin-top:6px;">
    <div style="flex:1">
      <label>Qty</label>
      <input type="number" id="iQty" inputmode="numeric">
    </div>
    <div style="flex:1">
      <label>Harga</label>
      <input type="text" id="iHarga"
             inputmode="numeric"
             oninput="formatRupiahInput(this)">
    </div>
  </div>

  <button onclick="tambah()">‚ûï Tambah ke Tabel</button>
</div>

<!-- TABEL -->
<table id="tabel">
<tr>
  <th>No</th>
  <th>Barang</th>
  <th>Qty</th>
  <th>Harga</th>
  <th>Total</th>
  <th>Aksi</th>
</tr>
</table>

<h3>Grand Total: Rp <span id="grand">0</span></h3>

<label>Jumlah Transfer (TF)</label>
<input type="text" id="tf"
       inputmode="numeric"
       oninput="formatRupiahInput(this); hitungSisa()">

<h3>Sisa Bayar: Rp <span id="sisa">0</span></h3>

<button onclick="shareWA()">üì§ Share WhatsApp</button>
<button onclick="window.print()">üñ®Ô∏è Print Thermal</button>

<script>
/* ===== RUPIAH REALTIME ===== */
function formatRupiahInput(el){
  let v = el.value.replace(/[^0-9]/g,'');
  el.value = v ? Number(v).toLocaleString('id-ID') : '';
}
function getNumber(el){
  return Number(el.value.replace(/\./g,'')) || 0;
}
function rupiah(n){
  return n.toLocaleString('id-ID');
}

/* ===== TAMBAH BARANG ===== */
function tambah(){
  const barang = iBarang.value;
  const qty    = Number(iQty.value) || 0;
  const harga  = getNumber(iHarga);

  if(!barang || qty<=0 || harga<=0){
    alert('Lengkapi barang, qty, dan harga');
    return;
  }

  const total = qty * harga;
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td></td>
    <td>${barang}</td>
    <td>${qty}</td>
    <td>${rupiah(harga)}</td>
    <td class="total">${rupiah(total)}</td>
    <td>
      <button onclick="editBaris(this)">‚úèÔ∏è</button>
      <button onclick="hapus(this)">‚ùå</button>
    </td>
  `;
  tabel.appendChild(tr);

  iBarang.value='';
  iQty.value='';
  iHarga.value='';
  iBarang.focus();

  update();
}

/* ===== EDIT & HAPUS ===== */
function editBaris(btn){
  const tr = btn.closest('tr');
  const barang = prompt('Nama barang', tr.children[1].innerText);
  const qty    = prompt('Qty', tr.children[2].innerText);
  const harga  = prompt('Harga', tr.children[3].innerText.replace(/\./g,''));

  if(barang && qty && harga){
    const q = Number(qty);
    const h = Number(harga);
    tr.children[1].innerText = barang;
    tr.children[2].innerText = q;
    tr.children[3].innerText = rupiah(h);
    tr.children[4].innerText = rupiah(q*h);
    update();
  }
}
function hapus(btn){
  btn.closest('tr').remove();
  update();
}

/* ===== HITUNG ===== */
function update(){
  let grand = 0;
  document.querySelectorAll('#tabel tr').forEach((tr,i)=>{
    if(i===0) return;
    tr.children[0].innerText = i;
    grand += Number(tr.children[4].innerText.replace(/\./g,'')) || 0;
  });
  grandEl.innerText = rupiah(grand);
  hitungSisa();
}
function hitungSisa(){
  const grand = Number(grandEl.innerText.replace(/\./g,'')) || 0;
  const tfVal = getNumber(tf);
  sisaEl.innerText = rupiah(Math.max(0, grand - tfVal));
}

/* ===== SHARE WHATSAPP SEJAJAR ===== */
function padRight(text, length){
  return (text + ' '.repeat(length)).substring(0, length);
}
function shareWA(){
  let text =
`üìí *ZALTA GIFT*
Barahan RT 05 RW 02 Tarub
Tawangharjo, Grobogan
HP/WA: 08816575574 / 081476698677
----------------------------
\`\`\`
No Barang           Qty   Harga      Total
------------------------------------------
`;

  document.querySelectorAll('#tabel tr').forEach((tr,i)=>{
    if(i===0) return;
    const barang = padRight(tr.children[1].innerText,16);
    const qty    = padRight(tr.children[2].innerText,5);
    const harga  = padRight(tr.children[3].innerText,10);
    const total  = padRight(tr.children[4].innerText,10);
    text += `${padRight(i+'.',3)}${barang} ${qty} ${harga} ${total}\n`;
  });

  text +=
`------------------------------------------
Grand Total : Rp ${grandEl.innerText}
TF          : Rp ${rupiah(getNumber(tf))}
Sisa Bayar  : Rp ${sisaEl.innerText}
\`\`\`
Terima kasih üôè`;

  window.open('https://wa.me/?text=' + encodeURIComponent(text),'_blank');
}

const grandEl = document.getElementById('grand');
const sisaEl  = document.getElementById('sisa');
</script>

</body>
</html>
